# Azure Pipelines YAML for building / running the process_updates.py script.
# Minimal starter pipeline: triggers on main and runs a Python script on the specified agent pool.
# Docs: https://aka.ms/yaml

# Which branches trigger the pipeline
trigger:
  - main   # run pipeline on pushes/PRs to the main branch

# Agent pool to run jobs on (replace with your org's pool or use 'AzurePipelines' for Microsoft-hosted)
pool: DetectionPool  # name of the agent pool or VM scale set

steps:
  # Use the built-in PythonScript task to run a Python file from the repo
- task: PythonScript@0
  inputs:
    scriptSource: 'filePath'          # run a script file from the repository
    scriptPath: './process_updates.py' # relative path to the Python script to execute
  env:
    BUILD_SOURCE_VERSION: $(Build.SourceVersion)  # expose the commit SHA as an env var to the script
    SPLUNK_API: $(splunkapi)                      # pipeline variable (secret or defined in pipeline) for Splunk API endpoint/token

